# 查询处理和代价
- 查询处理(query processing)是指从数据库提取数据时设计的一系列活动。包括:
    1. 语法分析，翻译成关系代数表达式
    2. 优化
    3. 执行

1. 对于给定的一个查询，一般会有多种计算结果的方法。
    - 即一条SQL可以翻译成多个等价的关系代数表达式
    - 每个表达式的代价是不一样的


2. 执行查询不仅要提供关系代数表达式，还需要加上注释来说明如何执行每个操作。
    - 注释可以声明某个具体操作所采用的算法或使用一个或多个特定的索引
    - 加了注释的关系代数运算称为 `计算原语`(evaluation primitive)
    
    - 执行一个查询的原语操作序列称为 `查询执行计划`(query-execution plan)

    - `查询执行引擎`(query-execution engine)接收一个查询执行计划，执行计划并把结果返回。

3. 给定的查询的不同执行计划有不同的代价。选出最小代价的执行计划是系统的责任。这项工作叫查询优化

## 查询代价的度量
- 我们需要比较不同查询计算计划的代价。

- 代价一般可以用对各种资源的使用情况进行度量，一般有：
    1. 磁盘存取
    2. 执行查询所用CPU时间
    3. 分布式数据库系统的通信代价

- 在一般数据库系统中，存取代价(即I/O代价)是最主要的代价。

- 为了简化，我们仅用磁盘存取代价来度量查询执行计划的代价。

- 我们用 `传送磁盘块数` 和 `搜索磁盘次数` 来度量查询计算计划的代价。
    - 假设磁盘传输一个块平均消耗 `t` 秒， 磁盘平均访问时间为`s`秒，则一次传输`b`个块以及执行`n`次查询的操作将消耗 ： `b*t + n*s` 秒

- 一般写磁盘代价是读磁盘的2倍(写完后需要重新读取验证操作是否成功)，为了简化我们忽略。

- 我们假设缓冲区是最坏的情况：大约每个关系一块


## 选择运算


## 连接运算

### 嵌套循环连接
- 嵌套循环连接为外层的每一个元组数据遍历一次内层的元组数据
- 设r的元组数为nr，s的元组数为ns，r的数据块有br个，s的数据块有bs个

- 嵌套循环是外层顺序读取，每读取一块就把内层遍历一遍
- 最坏情况下，内存只能容纳一个数据块，所以我们一次只能读1个数据块,设r为外层，s为内层 看出来，块数乘以记录数
    - 所以读取块数 = br+bs*nr

### 块嵌套循环连接
- 块嵌套循环连接是以块为单位 为外层的每一块 遍历一次内层的块数据

- 即设r的元组数为nr，s的元组数为ns，r的数据块有br个，s的数据块有bs个 设r外层，s内层

- 最坏情况下 读取块数 = br+ br*sr

